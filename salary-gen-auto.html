<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Slip Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-light: #f8f9fa;
            --bg-white: #fff;
            --border-color: #dee2e6;
            --shadow-color: rgba(0,0,0,.15);
            --header-bg: #f1f1f1;
            --header-text: #343a00;
            --total-row-bg: #e9ecef;
            --net-pay-bg: #d1e7dd;
            --net-pay-border: #0f5132;
        }

        body { background-color: var(--bg-light); }
        .salary-slip { max-width: 800px; margin: 40px auto; background-color: var(--bg-white); border: 1px solid var(--border-color); box-shadow: 0 0.5rem 1rem var(--shadow-color); padding: 30px; font-family: Arial, sans-serif; border-radius: 8px; }
        .company-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .company-logo { max-width: 80px; height: auto; }
        .company-info { text-align: right; }
        .details-section, .earnings-deductions-section { margin-bottom: 20px; }
        .table th, .table td { font-size: 14px; padding: 8px; }
        .table th { background-color: var(--header-bg); color: var(--header-text); }
        .total-row th, .total-row td { font-weight: bold; background-color: var(--total-row-bg); }
        .net-pay-container { display: flex; align-items: flex-start; justify-content: space-between; }
        .net-pay-in-words { background-color: var(--net-pay-bg); padding: 10px; border: 1px dashed var(--net-pay-border); border-radius: 5px; font-weight: bold; margin-top: 20px; font-size: 14px; flex-grow: 1; }
        .empty-space { width: 150px; margin-left: 20px; }
        @media (max-width: 768px) { .company-header { flex-direction: column; align-items: center; text-align: center; } .company-info { text-align: center; margin-top: 10px; } .net-pay-container { flex-direction: column; } .empty-space { display: none; } }
        #inputSection { background-color: var(--bg-white); padding: 20px; border-radius: 8px; box-shadow: 0 0.5rem 1rem var(--shadow-color); margin-bottom: 20px; }
        #outputSection { display: none; }
    </style>
</head>
<body>

    <!-- If the monthly is above 12Lacs it doesnt calculate tds accurately -->

    <div class="container">
        
        <div id="inputSection">
            <h2 class="mb-4 text-center">Generate Salary Slip</h2>
            <form id="salary-form">
                <div class="row">
                    <div class="col-md-6 mb-3"><label for="employeeName" class="form-label">Employee Name</label><input type="text" class="form-control" id="employeeName" required></div>
                    <div class="col-md-6 mb-3"><label for="employeeId" class="form-label">Employee ID</label><input type="text" class="form-control" id="employeeId"></div>
                    <div class="col-md-6 mb-3"><label for="designation" class="form-label">Designation</label><input type="text" class="form-control" id="designation"></div>
                    <div class="col-md-6 mb-3"><label for="department" class="form-label">Department</label><input type="text" class="form-control" id="department"></div>
                    <div class="col-md-6 mb-3"><label for="joiningDate" class="form-label">Date of Joining</label><input type="text" class="form-control" id="joiningDate"></div>
                    <div class="col-md-6 mb-3"><label for="payPeriod" class="form-label">Pay Period</label><input type="text" class="form-control" id="payPeriod" required></div>
                    <div class="col-md-6 mb-3"><label for="totalDays" class="form-label">Total Days in Month</label><input type="number" class="form-control" id="totalDays" min="0"></div>
                    <div class="col-md-6 mb-3"><label for="paidDays" class="form-label">Paid Days</label><input type="number" class="form-control" id="paidDays" min="0"></div>
                    <div class="col-md-6 mb-3"><label for="panNo" class="form-label">PAN No</label><input type="text" class="form-control" id="panNo"></div>
                    <div class="col-md-6 mb-3"><label for="bankName" class="form-label">Bank Name</label><input type="text" class="form-control" id="bankName"></div>
                    <div class="col-md-6 mb-3"><label for="bankAccNo" class="form-label">Bank A/c No</label><input type="text" class="form-control" id="bankAccNo"></div>
                    <div class="col-md-6 mb-3"><label for="esicNo" class="form-label">ESIC No</label><input type="text" class="form-control" id="esicNo"></div>
                    <div class="col-md-6 mb-3"><label for="uanNo" class="form-label">UAN No</label><input type="text" class="form-control" id="uanNo"></div>
                </div>
                
                <h4 class="mt-4">Salary Inputs</h4>
                <div class="row">
                    <div class="col-md-6 mb-3"><label for="basicSalary" class="form-label">Basic Salary (₹)</label><input type="number" class="form-control" id="basicSalary" required min="0"></div>
                    <div class="col-md-6 mb-3"><label for="hra" class="form-label">HRA (₹)</label><input type="number" class="form-control" id="hra" min="0"></div>
                    <div class="col-md-6 mb-3"><label for="conveyanceAllowance" class="form-label">Conveyance Allowance (₹)</label><input type="number" class="form-control" id="conveyanceAllowance" min="0"></div>
                    <div class="col-md-6 mb-3"><label for="specialAllowance" class="form-label">Special Allowance (₹)</label><input type="number" class="form-control" id="specialAllowance" min="0"></div>
                    <div class="col-md-6 mb-3"><label for="professionalTax" class="form-label">Professional Tax (₹)</label><input type="number" class="form-control" id="professionalTax" value="200" min="0"></div>
                    <div class="col-md-6 mb-3 align-self-center"><div class="form-check"><input class="form-check-input" type="checkbox" id="pfOptIn"><label class="form-check-label" for="pfOptIn">Opt-in for PF (12% of Basic)</label></div></div>
                </div>

                <div id="messageBox" class="alert alert-danger" style="display:none;"></div>
                <button type="submit" class="btn btn-success w-100 mt-3">Generate Salary Slip</button>
            </form>
        </div>

        <div id="outputSection">
            <div class="salary-slip" id="salary-slip">
                <div class="company-header">
                    <img src="https://placehold.co/80x80/0d6efd/ffffff?text=CA" alt="Company Logo" class="company-logo">
                    <div class="company-info">
                        <h2>CYBER ALLIANCE INDIA</h2>
                        <p>DWARKA SECTOR - 24, NEW DELHI - 110077</p>
                        <p>COMPANY PAN: AAVFC4620K</p>
                    </div>
                </div>
                
                <div class="details-section">
                    <h5 class="mb-3 text-center">PAYSLIP FOR <span id="slipPayPeriod"></span></h5>
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless table-sm">
                                <tr><th>Employee Name:</th><td id="slipEmployeeName"></td></tr>
                                <tr><th>Employee ID:</th><td id="slipEmployeeId"></td></tr>
                                <tr><th>Designation:</th><td id="slipDesignation"></td></tr>
                                <tr><th>Department:</th><td id="slipDepartment"></td></tr>
                                <tr><th>Date of Joining:</th><td id="slipJoiningDate"></td></tr>
                                <tr><th>PAN No:</th><td id="slipPanNo"></td></tr>
                                <tr><th>Bank A/c No:</th><td id="slipBankAccNo"></td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless table-sm">
                                <tr><th>Total Days:</th><td id="slipTotalDays"></td></tr>
                                <tr><th>Paid Days:</th><td id="slipPaidDays"></td></tr>
                                <tr><th>Bank Name:</th><td id="slipBankName"></td></tr>
                                <tr><th>UAN No:</th><td id="slipUanNo"></td></tr>
                                <tr><th>ESIC No:</th><td id="slipEsicNo"></td></tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="earnings-deductions-section">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-bordered table-sm">
                                <thead class="table-primary">
                                    <tr>
                                        <th>Earnings</th>
                                        <th class="text-end">Amount (₹)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>Basic Salary</td><td class="text-end" id="slipBasicSalary"></td></tr>
                                    <tr><td>House Rent Allowance (HRA)</td><td class="text-end" id="slipHra"></td></tr>
                                    <tr><td>Conveyance Allowance</td><td class="text-end" id="slipConveyanceAllowance"></td></tr>
                                    <tr><td>Special Allowance</td><td class="text-end" id="slipSpecialAllowance"></td></tr>
                                    <tr class="total-row">
                                        <th>Gross Earnings</th>
                                        <th class="text-end" id="slipGrossEarnings"></th>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="col-md-6">
                            <table class="table table-bordered table-sm">
                                <thead class="table-danger">
                                    <tr>
                                        <th>Deductions</th>
                                        <th class="text-end">Amount (₹)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>Provident Fund (Employee)</td><td class="text-end" id="slipPfEmployee"></td></tr>
                                    <tr><td>Professional Tax</td><td class="text-end" id="slipProfessionalTax"></td></tr>
                                    <tr><td>TDS (Tax Deducted at Source)</td><td class="text-end" id="slipTds"></td></tr>
                                    <tr><td>ESIC (Employee)</td><td class="text-end" id="slipEsicEmployee"></td></tr>
                                    <tr class="total-row">
                                        <th>Total Deductions</th>
                                        <th class="text-end" id="slipTotalDeductions"></th>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="row my-4">
                    <div class="col-12">
                        <table class="table table-bordered table-sm">
                            <tr class="total-row">
                                <th>Net Pay (in Figures)</th>
                                <td class="text-end" id="slipNetPay"></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="net-pay-container">
                    <div class="net-pay-in-words" id="slipNetPayWords"></div>
                    <div class="empty-space"></div>
                </div>
                
            </div>
            
            <div class="text-center mt-4">
                <button id="downloadBtn" class="btn btn-primary btn-lg">Download as PDF</button>
                <button id="resetBtn" class="btn btn-secondary btn-lg ms-2">Create New Slip</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
    (function() {
        // --- CONFIGURATION ---
        const TAX_CONFIG = {
            // Rules for FY 2025-26 (AY 2026-27) - New Tax Regime
            standardDeduction: 75000,
            rebateLimit: 1200000, // Taxable income limit for full rebate
            cessRate: 0.04,
            slabs: [
                { min: 0, max: 1200000, rate: 0 }, // Effective rate due to rebate
                { min: 1200001, max: 1600000, rate: 0.15 },
                { min: 1600001, max: 2000000, rate: 0.20 },
                { min: 2000001, max: 2400000, rate: 0.25 },
                { min: 2400001, max: Infinity, rate: 0.30 }
            ]
        };

        // --- DOM ELEMENT CACHING ---
        const salaryForm = document.getElementById('salary-form');
        const inputSection = document.getElementById('inputSection');
        const outputSection = document.getElementById('outputSection');
        const messageBox = document.getElementById('messageBox');
        const downloadBtn = document.getElementById('downloadBtn');
        const resetBtn = document.getElementById('resetBtn');

        // --- HELPER FUNCTIONS ---
        const formatNumber = (num) => parseFloat(num).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        
        const numberToWords = (num) => {
            const a = ['','one ','two ','three ','four ', 'five ','six ','seven ','eight ','nine ','ten ','eleven ','twelve ','thirteen ','fourteen ','fifteen ','sixteen ','seventeen ','eighteen ','nineteen '];
            const b = ['', '', 'twenty','thirty','forty','fifty', 'sixty','seventy','eighty','ninety'];
            
            if ((num = num.toString()).length > 9) return 'overflow';
            const n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
            if (!n) return ''; 
            let str = '';
            str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'crore ' : '';
            str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'lakh ' : '';
            str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'thousand ' : '';
            str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'hundred ' : '';
            str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) : '';
            return str.trim().split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ') + ' Rupees';
        };

        const calculateTds = (grossAnnualIncome) => {
            let taxableIncome = grossAnnualIncome - TAX_CONFIG.standardDeduction;
            if (taxableIncome < 0) return 0;

            // Apply rebate
            if (taxableIncome <= TAX_CONFIG.rebateLimit) return 0;
            
            let tax = 0;
            const applicableSlabs = TAX_CONFIG.slabs.filter(slab => taxableIncome > slab.min);
            
            // This is a simplified progressive calculation. A more robust one is needed for complex cases.
            // For this specific slab structure starting at 12L, this approach works.
            if (taxableIncome > 2400000) tax += (taxableIncome - 2400000) * 0.30;
            if (taxableIncome > 2000000) tax += (Math.min(taxableIncome, 2400000) - 2000000) * 0.25;
            if (taxableIncome > 1600000) tax += (Math.min(taxableIncome, 2000000) - 1600000) * 0.20;
            if (taxableIncome > 1200000) tax += (Math.min(taxableIncome, 1600000) - 1200000) * 0.15;

            const cess = tax * TAX_CONFIG.cessRate;
            const totalTax = tax + cess;
            return Math.max(0, totalTax);
        };
        
        // --- CORE LOGIC FUNCTIONS ---
        const readFormData = () => {
            const formElements = salaryForm.elements;
            return {
                employeeName: formElements.employeeName.value,
                employeeId: formElements.employeeId.value,
                designation: formElements.designation.value,
                department: formElements.department.value,
                joiningDate: formElements.joiningDate.value,
                payPeriod: formElements.payPeriod.value,
                totalDays: parseFloat(formElements.totalDays.value) || 0,
                paidDays: parseFloat(formElements.paidDays.value) || 0,
                panNo: formElements.panNo.value,
                bankAccNo: formElements.bankAccNo.value,
                bankName: formElements.bankName.value,
                esicNo: formElements.esicNo.value,
                uanNo: formElements.uanNo.value,
                basicSalary: parseFloat(formElements.basicSalary.value) || 0,
                hra: parseFloat(formElements.hra.value) || 0,
                conveyanceAllowance: parseFloat(formElements.conveyanceAllowance.value) || 0,
                specialAllowance: parseFloat(formElements.specialAllowance.value) || 0,
                professionalTax: parseFloat(formElements.professionalTax.value) || 0,
                pfOptIn: formElements.pfOptIn.checked
            };
        };
        
        const calculateSalaryDetails = (formData) => {
            // Proration factor
            const prorateFactor = (formData.totalDays > 0 && formData.paidDays > 0 && formData.paidDays <= formData.totalDays) ? (formData.paidDays / formData.totalDays) : 1;

            // Prorated Earnings
            const basicSalary = formData.basicSalary * prorateFactor;
            const hra = formData.hra * prorateFactor;
            const conveyanceAllowance = formData.conveyanceAllowance * prorateFactor;
            const specialAllowance = formData.specialAllowance * prorateFactor;
            const grossEarnings = basicSalary + hra + conveyanceAllowance + specialAllowance;

            // Deductions
            const pfEmployee = formData.pfOptIn ? formData.basicSalary * 0.12 : 0;
            const esicEmployee = (grossEarnings <= 21000) ? grossEarnings * 0.0075 : 0;
            
            const fullGrossMonthly = formData.basicSalary + formData.hra + formData.conveyanceAllowance + formData.specialAllowance;
            const grossAnnualIncome = fullGrossMonthly * 12;
            const annualTds = calculateTds(grossAnnualIncome);
            const monthlyTds = annualTds / 12;

            const totalDeductions = pfEmployee + formData.professionalTax + monthlyTds + esicEmployee;
            const netPay = grossEarnings - totalDeductions;

            return {
                prorated: { basicSalary, hra, conveyanceAllowance, specialAllowance, grossEarnings },
                deductions: { pfEmployee, esicEmployee, professionalTax: formData.professionalTax, monthlyTds, totalDeductions },
                netPay
            };
        };

        const updateSlipUI = (salaryDetails, formData) => {
            const { prorated, deductions, netPay } = salaryDetails;

            // Employee & Pay Details
            document.getElementById('slipPayPeriod').innerText = formData.payPeriod;
            document.getElementById('slipEmployeeName').innerText = formData.employeeName;
            document.getElementById('slipEmployeeId').innerText = formData.employeeId;
            document.getElementById('slipDesignation').innerText = formData.designation;
            document.getElementById('slipDepartment').innerText = formData.department;
            document.getElementById('slipJoiningDate').innerText = formData.joiningDate;
            document.getElementById('slipPanNo').innerText = formData.panNo;
            document.getElementById('slipBankAccNo').innerText = formData.bankAccNo;
            document.getElementById('slipTotalDays').innerText = formData.totalDays;
            document.getElementById('slipPaidDays').innerText = formData.paidDays;
            document.getElementById('slipBankName').innerText = formData.bankName;
            document.getElementById('slipUanNo').innerText = formData.uanNo;
            document.getElementById('slipEsicNo').innerText = formData.esicNo;

            // Earnings
            document.getElementById('slipBasicSalary').innerText = formatNumber(prorated.basicSalary);
            document.getElementById('slipHra').innerText = formatNumber(prorated.hra);
            document.getElementById('slipConveyanceAllowance').innerText = formatNumber(prorated.conveyanceAllowance);
            document.getElementById('slipSpecialAllowance').innerText = formatNumber(prorated.specialAllowance);
            document.getElementById('slipGrossEarnings').innerText = formatNumber(prorated.grossEarnings);

            // Deductions
            document.getElementById('slipPfEmployee').innerText = formatNumber(deductions.pfEmployee);
            document.getElementById('slipProfessionalTax').innerText = formatNumber(deductions.professionalTax);
            document.getElementById('slipTds').innerText = formatNumber(deductions.monthlyTds);
            document.getElementById('slipEsicEmployee').innerText = formatNumber(deductions.esicEmployee);
            document.getElementById('slipTotalDeductions').innerText = formatNumber(deductions.totalDeductions);

            // Net Pay
            document.getElementById('slipNetPay').innerText = `₹ ${formatNumber(netPay)}`;
            document.getElementById('slipNetPayWords').innerText = `Net Pay in Words: ${numberToWords(Math.round(netPay))} Only.`;
        };

        const validateForm = (formData) => {
            if (!formData.employeeName || !formData.basicSalary || !formData.payPeriod) {
                messageBox.innerText = 'Please fill in Employee Name, Pay Period, and Basic Salary.';
                messageBox.style.display = 'block';
                return false;
            }
            if (formData.paidDays > formData.totalDays) {
                messageBox.innerText = 'Paid days cannot be more than total days.';
                messageBox.style.display = 'block';
                return false;
            }
            messageBox.style.display = 'none';
            return true;
        };

        // --- EVENT HANDLERS ---
        const handleFormSubmit = (event) => {
            event.preventDefault();
            const formData = readFormData();
            
            if (!validateForm(formData)) return;
            
            const salaryDetails = calculateSalaryDetails(formData);
            updateSlipUI(salaryDetails, formData);
            
            inputSection.style.display = 'none';
            outputSection.style.display = 'block';
        };

        const downloadPdf = () => {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById('salary-slip');
            const employeeName = document.getElementById('employeeName').value;
            const payPeriod = document.getElementById('payPeriod').value;
            
            html2canvas(element, { scale: 2, useCORS: true }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');

                pdf.setProperties({
                    title: `Salary Slip - ${employeeName} - ${payPeriod}`,
                    subject: `Monthly Pay Slip for ${payPeriod}`,
                    author: "Cyber Alliance India",
                    creator: 'Cyber Alliance Payroll Generator'
                });

                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save(`Salary_Slip_${employeeName.replace(/\s/g, '_')}_${payPeriod}.pdf`);
            });
        };

        const resetApp = () => {
            salaryForm.reset();
            outputSection.style.display = 'none';
            inputSection.style.display = 'block';
            messageBox.style.display = 'none';
        };

        // --- EVENT LISTENERS ---
        salaryForm.addEventListener('submit', handleFormSubmit);
        downloadBtn.addEventListener('click', downloadPdf);
        resetBtn.addEventListener('click', resetApp);

    })();
    </script>
</body>
</html>